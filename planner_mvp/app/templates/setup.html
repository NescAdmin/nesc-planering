<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Registrera f√∂retag ‚Äì {{app_name}}</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}
<div class="container narrow" style="margin-top:18px;">
  <h1>Registrera f√∂retag</h1>
  <p class="muted">F√∂rsta g√•ngen: skapa f√∂retag, basregler och enhetskatalog.</p>

  <form method="post" action="/setup" class="card">
    <h2>F√∂retag</h2>
    <label>F√∂retagsnamn</label>
    <input name="company_name" required placeholder="NESC AB"/>

    <div class="grid2">
      <div>
        <label>Arbetstid start</label>
        <input name="work_start" value="08:00"/>
      </div>
      <div>
        <label>Arbetstid slut</label>
        <input name="work_end" value="17:00"/>
      </div>
    </div>

    <h2>Inloggning / Admin</h2>

    {% if users|length == 0 %}
      <p class="muted">Inga anv√§ndare finns √§nnu. Skapa f√∂rsta admin s√• kan du bjuda in fler senare.</p>
      <div class="grid2">
        <div>
          <label>Namn</label>
          <input name="admin_name" required placeholder="F√∂rnamn Efternamn" value="{{prefill_admin_name or ''}}"/>
        </div>
        <div>
          <label>E-post</label>
          <input name="admin_email" required placeholder="namn@nesc.se" value="{{prefill_admin_email or ''}}"/>
        </div>
      </div>
    {% else %}
      <p class="muted">V√§lj vilka befintliga anv√§ndare som ska ing√• i f√∂retaget. Du kan l√§gga till/ta bort personer senare under <strong>F√∂retag</strong>.</p>
      <div class="list">
        {% for u in users %}
          <label class="row">
            <input type="checkbox" name="member_user_ids" value="{{u.id}}" checked/>
            <span>{{u.name}}{% if u.email %} ({{u.email}}){% endif %} ‚Äî <span class="muted">{{u.role}}</span></span>
          </label>
        {% endfor %}
      </div>
    {% endif %}

    <h2>Enheter (enhetskatalog)</h2>
    <p class="muted">Du kan ta bort rader du inte vill ha och l√§gga till egna.</p>

    <table class="table" id="unitTable">
      <thead>
        <tr><th>Namn</th><th>Minuter/enhet</th><th>Ikon</th><th></th></tr>
      </thead>
      <tbody>
        <tr>
          <td><input name="unit_names" value="HD/F"/></td>
          <td><input name="unit_minutes" type="number" value="30"/></td>
          <td><input name="unit_icons" value="üîß"/></td>
          <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove">Ta bort</button></td>
        </tr>
        <tr>
          <td><input name="unit_names" value="V√§gg"/></td>
          <td><input name="unit_minutes" type="number" value="60"/></td>
          <td><input name="unit_icons" value="üß±"/></td>
          <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove">Ta bort</button></td>
        </tr>
        <tr>
          <td><input name="unit_names" value="STT"/></td>
          <td><input name="unit_minutes" type="number" value="60"/></td>
          <td><input name="unit_icons" value="üß©"/></td>
          <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove">Ta bort</button></td>
        </tr>
      </tbody>
    </table>

    <button type="button" class="btn" id="addUnitRow">+ L√§gg till rad</button>

    <div style="margin-top:14px">
      <button class="btn primary" type="submit">Skapa f√∂retag</button>
    </div>
  </form>

  <p class="muted" style="margin-top:10px;">Tips: Om n√•got blir fel efter m√•nga √§ndringar lokalt kan du b√∂rja om genom att radera databasen och k√∂ra seed igen.</p>
</div>

<script>
(function(){
  const tbody = document.querySelector("#unitTable tbody");
  function bindRemove(btn){
    btn.addEventListener("click", () => {
      const tr = btn.closest("tr");
      if(tr) tr.remove();
    });
  }
  document.querySelectorAll(".unit-remove").forEach(bindRemove);

  document.getElementById("addUnitRow").addEventListener("click", () => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input name="unit_names" placeholder="Namn"/></td>
      <td><input name="unit_minutes" type="number" value="60"/></td>
      <td><input name="unit_icons" value="‚ñ†"/></td>
      <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove">Ta bort</button></td>
    `;
    bindRemove(tr.querySelector(".unit-remove"));
    tbody.appendChild(tr);
  });
})();
</script>
</body>
</html>
