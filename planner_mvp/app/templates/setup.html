<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Registrera f√∂retag ‚Äì {{app_name}}</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}

<div class="container auth-shell">
  <div class="auth-grid">
    <div class="auth-side">
      <div class="auth-kicker">üè¢ F√∂rsta g√•ngen: skapa f√∂retag och basinst√§llningar</div>
      <div class="auth-title">Registrera f√∂retag</div>
      <div class="auth-subtitle">
        Detta g√∂rs <strong>en g√•ng</strong> per installation. Efter√•t loggar alla in med Microsoft och arbetar i samma tidschema.
      </div>

      <div class="auth-steps">
        <div class="auth-step">
          <div class="num">1</div>
          <div>
            <div class="txt"><strong>F√∂retag</strong></div>
            <div class="sub">namn + arbetstider (anv√§nds i dagsvyn)</div>
          </div>
        </div>
        <div class="auth-step">
          <div class="num">2</div>
          <div>
            <div class="txt"><strong>F√∂rsta admin</strong></div>
            <div class="sub">personen som kan l√§gga till/ta bort anv√§ndare och enheter</div>
          </div>
        </div>
        <div class="auth-step">
          <div class="num">3</div>
          <div>
            <div class="txt"><strong>Enhetskatalog</strong></div>
            <div class="sub">l√§gg till/ta bort enheter och ange minuter (t.ex. 60 min = 1,0 h)</div>
          </div>
        </div>
      </div>

      <div class="muted" style="margin-top:14px;">
        Tips: Du kan alltid justera enheter och tider senare i <strong>F√∂retag</strong>.
      </div>
    </div>

    <form method="post" action="/setup" class="card auth-card">
      <div class="auth-card-head">
        <div>
          <div class="title">Skapa f√∂retag</div>
          <div class="muted" style="margin-top:4px;">Basinst√§llningar f√∂r {{app_name}}</div>
        </div>
        
      </div>

      <div class="grid2">
        <div>
          <label>F√∂retagsnamn</label>
          <input name="company_name" required placeholder="NESC AB"/>
        </div>
        <div>
          <label>Arbetstid per vecka</label>
          <input value="40 h" disabled/>
        </div>
      </div>

      <div class="grid2">
        <div>
          <label>Arbetstid start</label>
          <input name="work_start" value="08:00"/>
        </div>
        <div>
          <label>Arbetstid slut</label>
          <input name="work_end" value="17:00"/>
        </div>
      </div>

      <div style="margin-top:14px;"></div>
      <div class="h2">Inloggning / Admin</div>

      {% if users|length == 0 %}
        <div class="muted" style="margin-top:6px;">
          Skapa f√∂rsta admin. (Du kan bjuda in fler efter√•t.)
        </div>
        <div class="grid2">
          <div>
            <label>Namn</label>
            <input name="admin_name" required placeholder="F√∂rnamn Efternamn" value="{{prefill_admin_name or ''}}"/>
          </div>
          <div>
            <label>E-post</label>
            <input name="admin_email" required placeholder="namn@nesc.se" value="{{prefill_admin_email or ''}}"/>
          </div>
        </div>
      {% else %}
        <div class="muted" style="margin-top:6px;">
          V√§lj vilka befintliga anv√§ndare som ska ing√• i f√∂retaget.
        </div>
        <div class="list" style="margin-top:8px;">
          {% for u in users %}
            <label class="row" style="gap:12px; align-items:center;">
              <input type="checkbox" name="member_user_ids" value="{{u.id}}" checked style="width:auto; margin:0;"/>
              <span style="flex:1;">
                <strong>{{u.name}}</strong>{% if u.email %} ({{u.email}}){% endif %}
                <span class="muted">‚Äî {{u.role}}</span>
              </span>
            </label>
          {% endfor %}
        </div>
      {% endif %}

      <div style="margin-top:14px;"></div>
      <div class="h2">Enheter (enhetskatalog)</div>
      <div class="muted" style="margin-top:6px;">
        Ta bort rader du inte vill ha, eller l√§gg till egna.
      </div>

      <table class="table" id="unitTable" style="margin-top:10px;">
        <thead>
          <tr>
            <th style="width:42%;">Namn</th>
            <th style="width:22%;">Minuter</th>
            <th style="width:18%;">Ikon</th>
            <th style="width:18%;"></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input name="unit_names" value="HD/F"/></td>
            <td><input name="unit_minutes" type="number" value="30" min="0"/></td>
            <td><input name="unit_icons" value="üîß"/></td>
            <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove" style="margin-top:0;">Ta bort</button></td>
          </tr>
          <tr>
            <td><input name="unit_names" value="V√§gg"/></td>
            <td><input name="unit_minutes" type="number" value="60" min="0"/></td>
            <td><input name="unit_icons" value="üß±"/></td>
            <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove" style="margin-top:0;">Ta bort</button></td>
          </tr>
          <tr>
            <td><input name="unit_names" value="STT"/></td>
            <td><input name="unit_minutes" type="number" value="60" min="0"/></td>
            <td><input name="unit_icons" value="üß©"/></td>
            <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove" style="margin-top:0;">Ta bort</button></td>
          </tr>
        </tbody>
      </table>

      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px;">
        <button type="button" class="btn" id="addUnitRow" style="margin-top:0;">+ L√§gg till rad</button>
        <div class="muted small">(S√§tt minuter till 0 om du vill d√∂lja en enhet senare.)</div>
      </div>

      <div style="margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <button class="btn primary" type="submit" style="margin-top:0; padding:12px 14px; border-radius:12px;">Skapa f√∂retag</button>
        <div class="muted small">Du skickas vidare till login efter√•t.</div>
      </div>
    </form>
  </div>
</div>

<script>
(function(){
  const tbody = document.querySelector("#unitTable tbody");

  function bindRemove(btn){
    btn.addEventListener("click", () => {
      const tr = btn.closest("tr");
      if(tr) tr.remove();
    });
  }

  document.querySelectorAll(".unit-remove").forEach(bindRemove);

  document.getElementById("addUnitRow").addEventListener("click", () => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input name="unit_names" placeholder="Namn"/></td>
      <td><input name="unit_minutes" type="number" value="60" min="0"/></td>
      <td><input name="unit_icons" value="‚ñ†"/></td>
      <td style="text-align:right;"><button type="button" class="btn danger mini unit-remove" style="margin-top:0;">Ta bort</button></td>
    `;
    bindRemove(tr.querySelector(".unit-remove"));
    tbody.appendChild(tr);
  });
})();
</script>

</body>
</html>
