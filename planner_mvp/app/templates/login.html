<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>{{app_name}} – Logga in</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}
<div class="container" style="max-width:820px; margin-top:18px;">
  <div class="card" style="padding:22px;">
    <div style="display:flex; justify-content:space-between; align-items:baseline; gap:12px; flex-wrap:wrap;">
      <div>
        <div style="font-weight:800; font-size:22px;">Logga in</div>
        <div class="muted" style="margin-top:4px;">{{company.name}}</div>
      </div>
      <div class="muted">{{app_version}}</div>
    </div>

    {% if ms_provider_requested and not ms_configured %}
      <div class="badge danger" style="margin:14px 0;">
        Microsoft-inloggning är aktiverad men saknar konfiguration på Render (AZURE_CLIENT_ID / AZURE_CLIENT_SECRET).
      </div>
    {% endif %}

    {% if ms_configured %}
      <div style="margin-top:16px;">
        <a class="btn primary" href="/auth/microsoft?next={{ next|urlencode }}" style="display:inline-flex; align-items:center; gap:10px; padding:12px 16px;">
          <span style="font-weight:700;">Logga in med Microsoft</span>
          <span class="muted" style="font-size:13px;">(Entra ID)</span>
        </a>
      </div>
      <div class="muted" style="margin-top:10px; font-size:13px;">
        Använd din Microsoft-konto för att logga in.
      </div>
    {% else %}
      <div class="muted" style="margin-top:16px;">
        Microsoft-inloggning är inte aktiverad. (Sätt <code>AUTH_PROVIDER=azuread</code> och env-variablerna på Render.)
      </div>
    {% endif %}

    <details style="margin-top:16px;">
      <summary class="muted" style="cursor:pointer;">Admin/felsök: välj användare manuellt</summary>
      <div style="margin-top:10px;">
        <form method="post" action="/login" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <input type="hidden" name="next" value="{{next}}"/>
          <select name="user_id" style="min-width:280px;">
            {% for u in users %}
              <option value="{{u.id}}">{{u.name}}{% if u.email %} ({{u.email}}){% endif %}</option>
            {% endfor %}
          </select>
          <button class="btn" type="submit">Logga in</button>
        </form>
        <div class="muted" style="margin-top:8px; font-size:13px;">
          Om listan är tom: skapa första admin via <a href="/setup">Registrera företag</a> eller kör seed lokalt.
        </div>
      </div>
    </details>
  </div>
</div>
</body>
</html>
