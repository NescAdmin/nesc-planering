<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{{app_name}} ‚Äì Logga in</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}

<div class="container auth-shell">
  <div class="auth-grid">
    <div class="auth-side">
      <div class="auth-kicker">üîí S√§ker inloggning via Microsoft Entra ID</div>
      <div class="auth-title">{{app_name}}</div>
      <div class="auth-subtitle">
        Planera resurser och projekt vecka f√∂r vecka. F√∂retagskonto skapar du en g√•ng ‚Äì sedan loggar alla in med Microsoft.
      </div>

      <div class="auth-steps">
        <div class="auth-step">
          <div class="num">1</div>
          <div>
            <div class="txt"><strong>Logga in</strong> med ditt Microsoft-konto</div>
            <div class="sub">(samma konto som i organisationen)</div>
          </div>
        </div>
        <div class="auth-step">
          <div class="num">2</div>
          <div>
            <div class="txt"><strong>Registrera f√∂retag</strong> f√∂rsta g√•ngen</div>
            <div class="sub">skapa basinst√§llningar och enhetskatalog</div>
          </div>
        </div>
        <div class="auth-step">
          <div class="num">3</div>
          <div>
            <div class="txt"><strong>√ñppna tidschemat</strong> och b√∂rja planera</div>
            <div class="sub">dra projekt/enheter, f√∂lj scope & √∂ver/under</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card auth-card">
      <div class="auth-card-head">
        <div>
          <div class="title">Logga in</div>
          <div class="muted" style="margin-top:4px;">{{company.name if company else ""}}</div>
        </div>
        
      </div>

      {% if ms_provider_requested and not ms_configured %}
        <div class="alert danger">
          Microsoft-inloggning √§r aktiverad men saknar konfiguration p√• Render (<code>AZURE_CLIENT_ID</code> / <code>AZURE_CLIENT_SECRET</code>).
        </div>
      {% endif %}

      {% if ms_configured %}
        <div style="margin-top:10px;">
          <a class="btn ms" href="/auth/microsoft?next={{ next|urlencode }}" style="width:100%; justify-content:center; padding:12px 14px; border-radius:12px;">
            <svg width="18" height="18" viewBox="0 0 18 18" aria-hidden="true" focusable="false" style="display:block;">
              <rect x="0" y="0" width="8" height="8" fill="#f25022"/>
              <rect x="10" y="0" width="8" height="8" fill="#7fba00"/>
              <rect x="0" y="10" width="8" height="8" fill="#00a4ef"/>
              <rect x="10" y="10" width="8" height="8" fill="#ffb900"/>
            </svg>
            <span style="font-weight:800;">Logga in med Microsoft</span>
            <span class="ms-badge">Entra ID</span>
          </a>
          <div class="muted small" style="margin-top:10px;">
            Efter inloggning skickas du vidare till <strong>Tidschema</strong>.
          </div>
        </div>
      {% else %}
        <div class="alert warn">
          Microsoft-inloggning √§r inte aktiverad √§nnu. S√§tt <code>AUTH_PROVIDER=azuread</code> och Azure-variablerna p√• Render.
        </div>
      {% endif %}
      {% if manual_login_enabled %}

      <details style="margin-top:14px;">
        <summary class="muted" style="cursor:pointer;">Admin/fels√∂k: v√§lj anv√§ndare manuellt</summary>
        <div style="margin-top:10px;">
          <form method="post" action="/login" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <input type="hidden" name="next" value="{{next}}"/>
            <select name="user_id" style="min-width:280px; flex:1;">
              {% for u in users %}
                <option value="{{u.id}}">{{u.name}}{% if u.email %} ({{u.email}}){% endif %}</option>
              {% endfor %}
            </select>
            <button class="btn primary" type="submit" style="margin-top:0;">Logga in</button>
          </form>
          <div class="muted small" style="margin-top:8px;">
            Om listan √§r tom: skapa f√∂rsta admin via <a href="/setup">Registrera f√∂retag</a>.
          </div>
        </div>
      </details>
      {% endif %}

      <div class="muted small" style="margin-top:12px;">
        Beh√∂ver du skapa ett nytt f√∂retag? <a href="/setup">Registrera f√∂retag</a>
      </div>
    </div>
  </div>
</div>

</body>
</html>
