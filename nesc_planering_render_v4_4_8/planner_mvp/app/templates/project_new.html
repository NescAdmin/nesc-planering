<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Nytt projekt</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}
<div class="container">
  <div class="pagehead">
    <div>
      <h1>Skapa nytt projekt</h1>
      <div class="muted">Välj antal per enhetstyp. Tiden räknas automatiskt (antal × tid/enhet).</div>
    </div>
  </div>

  <form method="post" action="/projects/new" class="card">
    <label>Projektnamn</label>
    <input name="name" placeholder="Porsche" required/>

    <h2>Projektets innehåll (scope)</h2>
    <table class="table">
      <thead><tr><th>Enhet</th><th>Min/enhet</th><th>Antal</th><th>Tid (h)</th></tr></thead>
      <tbody>
        {% for u in units %}
          <tr>
            <td>{{u.icon}} {{u.name}}<input type="hidden" name="unit_type_ids" value="{{u.id}}"/></td>
            <td>{{u.default_minutes}}</td>
            <td><input class="qty" type="number" name="quantities" value="0" min="0" data-min="{{u.default_minutes}}"/></td>
            <td class="rowHours">0.0</td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" style="text-align:right">Total tid</th>
          <th id="totalHours">0.0</th>
        </tr>
      </tfoot>
    </table>

    <button class="btn primary" type="submit">Skapa projekt</button>
  </form>
</div>

<script>
(function(){
  function recalc(){
    let total = 0;
    document.querySelectorAll("tr").forEach(tr => {
      const q = tr.querySelector("input.qty");
      const cell = tr.querySelector(".rowHours");
      if(!q || !cell) return;
      const mins = parseInt(q.getAttribute("data-min")||"0", 10);
      const qty = parseInt(q.value||"0", 10);
      const hours = (mins*qty)/60.0;
      cell.textContent = hours.toFixed(1);
      total += hours;
    });
    document.getElementById("totalHours").textContent = total.toFixed(1);
  }
  document.querySelectorAll("input.qty").forEach(inp => inp.addEventListener("input", recalc));
  recalc();
})();
</script>
</body>
</html>
