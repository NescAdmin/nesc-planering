<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Rapport – 30 veckor</title>
  <link rel="stylesheet" href="/static/css/app.css"/>
</head>
<body>
{% include "partials_topbar.html" %}

<div class="container wide">
  <div class="pagehead">
    <div>
      <h1>Rapport – 30 veckor</h1>
      <div class="muted">Översikt av beläggning per person och vecka. Visar % samt timmar (planerat / kapacitet).</div>
    </div>

    <div class="pagehead-actions">
      <div class="navgrp">
        <a class="btn icon" title="Föregående 30 veckor" href="/report?ref={{prev_ref}}">←</a>
        <a class="btn icon" title="Hoppa till idag" href="/report?ref={{today_ref}}">Idag</a>
        <a class="btn icon" title="Nästa 30 veckor" href="/report?ref={{next_ref}}">→</a>
      </div>
      <div class="inline" style="gap:8px; align-items:center; margin-top:0">
        <input id="repRef" type="date" value="{{ref.isoformat()}}" style="width:auto; min-width:150px" />
      </div>
    </div>
  </div>

  <div class="card" style="padding:10px">
    <div class="hscroll">
      <table class="table report-table">
        <thead>
          <tr>
            <th class="sticky-col">Person</th>
            {% for per in periods %}
              <th class="week-col">
                <div>{{per.label}}</div>
                <div class="muted small">{{per.start|dm}}–{{per.end|dm}}</div>
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td class="sticky-col"><b>{{r.name}}</b></td>
              {% for c in r.cells %}
                <td class="report-cell band-{{c.band}} {{'over' if c.pct>100 else ''}}">
                  <div class="pctbadge {{'pct-over' if c.pct>100 else ''}}">{{c.pct}}%</div>
                  <div class="muted small">{{"%.1f"|format(c.hours)}}h / {{"%.1f"|format(c.cap_hours)}}h</div>
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  (function(){
    const el = document.getElementById('repRef');
    if(!el) return;
    el.addEventListener('change', () => {
      const v = el.value;
      if(!v) return;
      window.location.href = '/report?ref=' + encodeURIComponent(v);
    });
  })();
</script>

</body>
</html>
